<html>
<head>
<style type="text/css">

    .menu{
    }

    .menubarcontainer{
        border: 1px;
        border-color: black;
        border-style: solid;
        padding: 5px;
        display: block;
    }

    .menubarcontainer .menubar{
        border: 1px;
        border-color: black;
        border-style: solid;
        padding: 5px;
        margin: 2px;
        background-color: gold;
        float: left;
        display: block;
        width: 200px;
    }

    .menubarcontainer .menubar .entry{
        border: 1px;
        border-color: black;
        border-style: solid;
        padding: 5px;
        background-color: greenyellow;
        display: block;
    }

    .menubarcontainer .menubar .menuentry{
        border: 1px;
        border-color: black;
        border-style: solid;
        padding: 5px;
        background-color: #b8abd8;
        display: block;
    }

    .menubarcontainer .menubar .menuentry.selected{
        border: 3px;
        border-color: yellow;
        border-style: solid;
        padding: 5px;
        background-color: #b8abd8;
        display: block;
    }


</style>
</head>
<body>
<div>before</div>
<div id="menu1" class="menu">
    <button id="enter" >Enter Menu</button>

    <menu id="root" title="root">
        <!--option 1-->
        <menu id="menu1" title="Menu 1">
            <menu id="menu1.1" title="Menu 1.1">
                <menu id="menu1.1.1" title="Menu 1.1.1">
                    <entry id="entry1111">option 1111</entry>
                    <entry id="entry1112">option 1112</entry>
                    <entry id="entry1113">option 1113</entry>
                    <entry id="entry1114">option 1114</entry>
                </menu>
                <menu id="menu1.1.2" title="Menu 1.1.2">
                    <menu id="menu1.1.2.1" title="menu 1.1.2.1">
                        <entry id="entry1121">option 1121</entry>
                        <entry id="entry1122">option 1122</entry>
                        <entry id="entry1123">option 1123</entry>
                        <entry id="entry1124">option 1124</entry>
                    </menu>
                </menu>
                <menu id="menu1.1.3" title="menu 1.1.3">
                    <menu id="menu1.1.3.1" title="Menu 1.1.3.1">
                        <entry id="entry1131">option 1131</entry>
                        <entry id="entry1132">option 1132</entry>
                        <entry id="entry1133">option 1133</entry>
                        <entry id="entry1134">option 1134</entry>
                    </menu>
                </menu>
                <menu id="menu1.1.4" title="Menu 1.1.4">
                    <menu id="menu1.1.4" title="Menu 1.1.4.1">
                        <entry id="entry1141">option 1141</entry>
                        <entry id="entry1142">option 1142</entry>
                        <entry id="entry1143">option 1143</entry>
                        <entry id="entry1144">option 1144</entry>
                    </menu>
                </menu>
            </menu>
        </menu>
        <!--option 2-->
        <menu id="menu2" title="Menu 2">
            <menu id="menu2.1" title="Menu 2.1">
                <entry id="entry121">option 21</entry>
                <entry id="entry122">option 22</entry>
                <entry id="entry123">option 23</entry>
                <entry id="entry124">option 24</entry>
            </menu>
        </menu>
        <!--option 3-->
        <menu id="menu3" title="Menu 3">
            <menu id="menu3.1" title="Menu 3.1">
                <entry id="entry131">option 31</entry>
                <entry id="entry132">option 32</entry>
                <entry id="entry123">option 33</entry>
                <entry id="entry124">option 34</entry>
          </menu>
        </menu>
        <!--option 4-->
        <menu id="menu4" title="Menu 4">
            <menu id="menu4.1" title="Menu 4.1">
                <entry id="entry141">option 41</entry>
                <entry id="entry142">option 42</entry>
                <entry id="entry143">option 43</entry>
                <entry id="entry144">option 44</entry>
          </menu>
        </menu>
    </menu>

</div>

<div>after</div>
</body>

<script>
'use strict';
    var AccesibleMenu = (function(){

        //----- menu bar class ------------
        var MenuBar = function(menuElement, parentMenuBar, mainMenu){
            this.parent = parentMenuBar;
            this.id = null;
            this.title = null;
            this.submenus= [];
            this.entries = [];
            var tagname = menuElement.tagName.toLowerCase();
            this.id = menuElement.id;
            this.title = menuElement.title;

            //this is the main div for this menuBar. all hidden except the first level
            this.el = _createDiv(this.id, parentMenuBar === null, 'menubar');

            //create a title div for the menubar
            this.titlediv = _createDiv((this.id + "_title"), true, 'menutitle');
            this.titlediv.innerText = this.title;
            this.el.appendChild(this.titlediv);

            //but we also must add a entry to the parent menuBar
            if(this.parent != null){
                this.entries.push(new MenuEntry(this.el, this.parent, this));
                //this.parent.addMenuEntry(this);
            }

            mainMenu.menuBarContainer.appendChild(this.el);

            if(tagname === "menu"){
                //iterate over children, look for entries and sub-menus
                for(var i=0; i< menuElement.children.length; ++i){
                    var child = menuElement.children[i];
                    if(child.tagName.toLowerCase() === 'menu'){
                        this.submenus.push(new MenuBar(child, this, mainMenu));
                    }else if(child.tagName.toLowerCase() === 'entry'){
                        this.entries.push(new MenuEntry(child, this));
                    }
                }
            }
        };



        /**
         * receives the focus, display contents
         */
        MenuBar.prototype.activate = function(){

        }

        /**
         * retrieves and entry by id over the whole menubar tree
         */
        MenuBar.prototype.findEntry = function(id){
            for(var i=0; i<this.entries.length; ++i){
                if(this.entries[i].id === id)
                    return this.entries[i];
            }
            for(var j=0; j<this.submenus.length; ++j){
                var entry = this.submenus[j].findEntry(id);
                if(entry != null)
                    return entry;
            }
            return null;
        }


        //------- menu entry class ----------

        /**
         * if target = Menubar, this is an entry that controls a submenu.
         */
        var MenuEntry = function(entryElement, menuBarParent, target){
            this.parent = menuBarParent;
            this.id = entryElement.id;
            this.title = entryElement.innerText;
            this.target = target;
            var classname = 'entry';
            if(target !== undefined && target instanceof MenuBar){
                classname = 'menuentry';
            }
            this.el = _createDiv(this.id, true, classname);
            this.el.innerHTML = this.title;
            menuBarParent.el.appendChild(this.el);
        };


        /**
         * main entry point for perform things. based on context status it will decide
         * wich specific action (select, trigger) will be executed, and what other objects
         * must be notified.
         */
        MenuEntry.prototype.execute = function(context){
            if(context.currentry != this){
                //a selection. unselect previous?
                if(context.currentry != null)
                    context.currentry.unselect();
                context.currentry = this;
                this.select();
            }else{
                //a execution.
                this.trigger();
            }
        };

        /**
         *
         */
        MenuEntry.prototype.unselect = function(){

        };

        /**
         *
         */
        MenuEntry.prototype.select = function(){
            console.log("hey someone selected me! MenuEntry ", this.id);
        };

        /**
         *
         */
        MenuEntry.prototype.trigger = function(){
            console.log("hey someone triggered me! MenuEntry ", this.id);
        };


        //------------ main Menu class --------------
        //constructor
        var Menu = function(divid){
            this.menudiv = document.getElementById(divid);

            this.rootMenuBar = null;

            this.menuBarContainer = null;

            //status variables
            this.context = {
                triggerOnSelect: false,
                confirmBeforeTrigger: false,
                menubar: this.rootMenubar,
                currentry: null
            };

            var self = this;

            var entermenubtn = this.menudiv.querySelector("button#enter");
            entermenubtn.addEventListener("click", function(ev){self.onEnterMenu();});

            this.build();


            this.menudiv.addEventListener("click", function(ev){self.onClick(ev.srcElement);});
        };

        /**
         * iterate over the nested collection of ul and li, to build a model of them, while flatting the dom
         */
        Menu.prototype.build = function(){
            //this is the level 1
            var menu = this.menudiv.querySelector("menu");
            this.menudiv.removeChild(menu);
            this.menuBarContainer = _createDiv("menuBarContainer", true, 'menubarcontainer');
            this.menudiv.appendChild(this.menuBarContainer);
            this.rootMenuBar =new MenuBar(menu, null, this);
        };

        /**
         * handles on click events. receives the source DOM element
         */
        Menu.prototype.onClick = function(srcElement){

            console.log("onClick ", srcElement.id , srcElement.className);

            if(srcElement.className === "menutitle"){

            }else if(srcElement.className === "menucontainer"){

            }else if(srcElement.className === "menubar"){

            }else if(srcElement.className === "menuentry" || srcElement.className === "entry"){
                var entry = this.rootMenuBar.findEntry(srcElement.id);
                if(entry != null) entry.execute(this.context);
            }
        };




        /**
         *
         */
        Menu.prototype.onEnterMenu = function(){
           console.log("entering menu");
        };

        //--- private module methods ---

        function _createDiv(id, visible, classname){
            var div = document.createElement("div");
            div.id = id;
            if(classname !== undefined){
                div.className = classname;
            }
            _showDiv(div, visible);
            return div;
        };

        function _showDiv(div, visible){
            var style = window.getComputedStyle(div);
            var display = style.getPropertyValue('display');
            if(display === '') display = 'block';
            div.setAttribute("style", "display:"+(visible?display:"none"));
        };

        return Menu;
    })();

    var menu1 = new AccesibleMenu("menu1");



</script>

</html>